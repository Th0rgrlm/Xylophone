<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Xylophone: DE2 project: Electronically controlled xylophone</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Xylophone<span id="projectnumber">&#160;1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">DE2 project: Electronically controlled xylophone </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__c_1_2_users_2mgaho_2_documents_2_martin_2_school_2_v_u_t_25__semestr_2_d_e2_2project_2_xylophone_2_r_e_a_d_m_e"></a></p>
<h1><a class="anchor" id="autotoc_md1"></a>
Table of Contents</h1>
<ul>
<li>Original assignment</li>
<li>Team</li>
<li>Theoretical Description and Explanation</li>
<li>Hardware description</li>
<li>Software Description</li>
<li>What we learned</li>
<li>How to use</li>
<li>Video</li>
<li>Tools</li>
<li>References</li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Original assignment</h1>
<p>Build an electronic xylophone instrument that can be played using an Arduino microcontroller. The project will combine hardware and software components to create an interactive and programmable musical instrument capable of producing different tones and melodies. Incorporating a graphical user interface (GUI) to visualize the notes being played.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Team</h1>
<p>Martin G: Matúš C: Jonáš H: Max G:</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Theoretical description and explanation</h1>
<p>Max: <em>We wanna play a xylophone, but at the same time we don't! We want it to play by itself...</em></p>
<p>The project involves programming an Arduino microcontroller. The microcontroller will control a xylophone that can play 8 keys (C1-C2, 1 octave) using coils. We decided to expand the functionality to enable automatic playing of any MID/MIDI file. This requires an additional pre-processing subprogram to extract the relevant and usable information from the file and an EEPROM memory to store the note instructions on the microcontroller. The note being played is to be displayed on an OLED display.</p>
<p>The MID file is first processed in a program on PC, written in C. The <a href="https://www.music.mcgill.ca/~ich/classes/mumt306/StandardMIDIfileformat.html">MIDI format</a> is an extensive specification and only a few of the events (note on, key, note length, etc) are relevant to our use case. This means that much of the MID file can be erased. For the practicality of debugging and also beacause of the limited resources of the microcontroller, pre-processing is done on PC.</p>
<p>The data saved in a file with custom extension <code>.MXY</code> is sent to the microcontroller via USB. For PC - Arduino communication, UART is used. The blocks of data are stored in the board's RAM so they can be sent via I<sup>2</sup>C to the EEPROM. Once the song is saved on EEPROM, no communication between the PC and the board is necessary. In our implementation, the playing mode immediately follows the upload process. I<sup>2</sup>C is used to load the blocks of data from EEPROM (and memory) and signals are sent to the xylophone pins.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Hardware description</h1>
<h3><a class="anchor" id="autotoc_md6"></a>
Xylophone</h3>
<p><img src="https://github.com/user-attachments/assets/db7c0745-f5c5-4218-b780-6ea34aa5dd7e" alt="" width="400" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md7"></a>
autotoc_md7</h1>
<h3><a class="anchor" id="autotoc_md8"></a>
OLED display</h3>
<p><img src="https://github.com/user-attachments/assets/00d42a6d-9a74-4857-b003-9d14eb6a1511" alt="" width="400" class="inline"/> <img src="https://github.com/user-attachments/assets/08feb6dd-066e-454e-af2b-172b3e059c08" alt="" width="400" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md9"></a>
autotoc_md9</h1>
<h3><a class="anchor" id="autotoc_md10"></a>
Clock: DS3231SN 0912A3 208AB (larger), EEPROM: ATHYC532 (smaller)</h3>
<p><img src="https://github.com/user-attachments/assets/13526339-5759-4702-8f3d-8d95bcd76df1" alt="" width="400" height="260" class="inline"/> <img src="https://github.com/user-attachments/assets/ec665f28-bb57-4d0e-bc47-78641f2cdeb4" alt="" width="400" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md11"></a>
autotoc_md11</h1>
<h3><a class="anchor" id="autotoc_md12"></a>
Arduino + breadboard</h3>
<p><img src="https://github.com/user-attachments/assets/c600a844-5449-4f9d-9961-a646d0627320" alt="" width="400" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md13"></a>
Software description</h1>
<p>This is the structure of the project's source files including the libraries and PC subprogram: </p><pre class="fragment">.
├── include
│     ├── pins.h        # Arduino pins
│     ├── structs.h     # Enum of note, pause and end events
│     ├── constants.h   # Buffer size constants
│     └── error_codes.h # Error codes definitions
├── lib
│     ├── gpio            # GPIO library (c) Tomas Fryza
│     ├── oled            # OLED display library (c) Skie-Systems
│     ├── twi             # I2C/TWI library (c) Tomas Fryza
│     └── uart            # UART library with r/t circular buffers (c) Peter Fleury
├── src
│     ├── main.c          # main program loop, init logic and interrupts
│     ├── display         # functions to display data on OLED
│     ├── eeprom          # EEPROM read/write functions
│     └── xylophone       # play note functions
├── pc                    # PC utility for MID pre-processing
|     ├── main.c          # MID convertor to MXY
|     ├── uart_pc.h       # PC UART communication with AVR
│     └── error_codes.h   # Error codes definitions for PC utility
└── platformio.ini        # PlatformIO framework config
</pre><h2><a class="anchor" id="autotoc_md14"></a>
Pins <sup><a href="https://github.com/Th0rgrlm/Xylophone/blob/main/include/pins.h">pins.h</a></sup></h2>
<p>In total, 8 pins are used for the notes of the xylophone. One other pin is reserved for the eventual manual control of the programming and playing mode.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define C1_PIN PD3</span></div>
<div class="line"><span class="preprocessor">#define D1_PIN PD4</span></div>
<div class="line"><span class="preprocessor">#define E1_PIN PD5</span></div>
<div class="line"><span class="preprocessor">#define F1_PIN PD6</span></div>
<div class="line"><span class="preprocessor">#define G1_PIN PD7</span></div>
<div class="line"><span class="preprocessor">#define A1_PIN PB0</span></div>
<div class="line"><span class="preprocessor">#define B1_PIN PB1</span></div>
<div class="line"><span class="preprocessor">#define C2_PIN PB2</span></div>
<div class="line"><span class="preprocessor">#define GPIO_PROGRAMM_MODE PC0</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md15"></a>
MIDI parser <sup><a href="https://github.com/Th0rgrlm/Xylophone/blob/main/pc/main.c">pc/main.c</a></sup></h2>
<p>The PC sub-program reads and parses a MID/MIDI file to extract select MIDI events listed in a table below. Once the file is opened, the MIDI file’s header is verified in <code><a class="el" href="pc_2main_8c.html#a6d00cda95a265aa44fab42f0bf5f70b1" title="Function for MIDI header verification.">verify_header(FILE* file)</a></code>. An output file with the extension <code>.mxy</code> is created and the parsed contents are written there. The function <code>read_track</code> invokes reading of the individual commands:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="pc_2main_8c.html#ae9096184487d9a0e07bafce10533b052">read_track</a>(FILE* midi_file, <a class="code hl_struct" href="structtrack__info.html">track_info_t</a>* track, FILE* out_file)</div>
<div class="line">{</div>
<div class="line">    int16_t result = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (result != END &amp;&amp; result != ERROR_POS) </div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; N_TRACKS; i++)</div>
<div class="line">        {</div>
<div class="line">            result = <a class="code hl_function" href="pc_2main_8c.html#ac0146909a72a990b6d7e1fbe6e29a10e">read_command</a>(midi_file,  &amp;track[i], out_file);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    printf(<span class="stringliteral">&quot;Parsing result: %d\n&quot;</span>, result == END ? SUCCESS : result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">int16_t <a class="code hl_function" href="pc_2main_8c.html#ac0146909a72a990b6d7e1fbe6e29a10e">read_command</a>(FILE* midi_file, <a class="code hl_struct" href="structtrack__info.html">track_info_t</a>* track, FILE* out_file)</div>
<div class="line">...</div>
<div class="ttc" id="apc_2main_8c_html_ac0146909a72a990b6d7e1fbe6e29a10e"><div class="ttname"><a href="pc_2main_8c.html#ac0146909a72a990b6d7e1fbe6e29a10e">read_command</a></div><div class="ttdeci">int16_t read_command(FILE *midi_file, track_info_t *track, FILE *out_file)</div><div class="ttdoc">Reads and parses single command from a current track position.</div><div class="ttdef"><b>Definition</b> main.c:358</div></div>
<div class="ttc" id="apc_2main_8c_html_ae9096184487d9a0e07bafce10533b052"><div class="ttname"><a href="pc_2main_8c.html#ae9096184487d9a0e07bafce10533b052">read_track</a></div><div class="ttdeci">void read_track(FILE *midi_file, track_info_t *track, FILE *out_file)</div><div class="ttdoc">Reads and parses single track.</div><div class="ttdef"><b>Definition</b> main.c:345</div></div>
<div class="ttc" id="astructtrack__info_html"><div class="ttname"><a href="structtrack__info.html">track_info</a></div><div class="ttdef"><b>Definition</b> main.c:79</div></div>
</div><!-- fragment --><p> The PC app is a console app and requires two additional arguments to be run. The first one is exact path of the file to be converted, the second one is COM port number the converted should be sent to. After that, the program will confirm the supplied file is an actual .mid file and converts it to a .mxy file. After that, the UART communication between PC and Arduino will begin. The file is sent in chunks of 256 bytes (because of RX receive buffer of the AVR). After each chunk is sent, Arduino checks for track end and writes the chunk to EEPROM. If no track end was found, it requests another chunk by sending &lsquo;'C&rsquo;<code>, otherwise it ends the communication by sending</code>'A'`.</p>
<h2><a class="anchor" id="autotoc_md16"></a>
MIDI events and their codes</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone"><b>Event Type</b>   </th><th class="markdownTableHeadNone"><b>Event Code</b>   </th><th class="markdownTableHeadNone"><b>Note</b>   </th><th class="markdownTableHeadNone"><b>MIDI Code</b>   </th><th class="markdownTableHeadNone"><b>MXY Code</b>    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Note Off   </td><td class="markdownTableBodyNone"><code>0x80</code>   </td><td class="markdownTableBodyNone">C1   </td><td class="markdownTableBodyNone"><code>60</code>   </td><td class="markdownTableBodyNone"><code>1</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Note On   </td><td class="markdownTableBodyNone"><code>0x90</code>   </td><td class="markdownTableBodyNone">D1   </td><td class="markdownTableBodyNone"><code>62</code>   </td><td class="markdownTableBodyNone"><code>2</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Control Change   </td><td class="markdownTableBodyNone"><code>0xB0</code>   </td><td class="markdownTableBodyNone">E1   </td><td class="markdownTableBodyNone"><code>64</code>   </td><td class="markdownTableBodyNone"><code>3</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Track Name   </td><td class="markdownTableBodyNone"><code>0x03</code>   </td><td class="markdownTableBodyNone">F1   </td><td class="markdownTableBodyNone"><code>65</code>   </td><td class="markdownTableBodyNone"><code>4</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Instrument Name   </td><td class="markdownTableBodyNone"><code>0x04</code>   </td><td class="markdownTableBodyNone">G1   </td><td class="markdownTableBodyNone"><code>67</code>   </td><td class="markdownTableBodyNone"><code>5</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Set Tempo   </td><td class="markdownTableBodyNone"><code>0x51</code>   </td><td class="markdownTableBodyNone">A1   </td><td class="markdownTableBodyNone"><code>69</code>   </td><td class="markdownTableBodyNone"><code>6</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Time Signature   </td><td class="markdownTableBodyNone"><code>0x58</code>   </td><td class="markdownTableBodyNone">B1   </td><td class="markdownTableBodyNone"><code>71</code>   </td><td class="markdownTableBodyNone"><code>7</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Key Signature   </td><td class="markdownTableBodyNone"><code>0x59</code>   </td><td class="markdownTableBodyNone">C2   </td><td class="markdownTableBodyNone"><code>72</code>   </td><td class="markdownTableBodyNone"><code>8</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SysEx Start   </td><td class="markdownTableBodyNone"><code>0xF0</code>   </td><td class="markdownTableBodyNone">Track End   </td><td class="markdownTableBodyNone"><code>0x2F</code>   </td><td class="markdownTableBodyNone"><code>0xFF</code>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">SysEx Restart   </td><td class="markdownTableBodyNone"><code>0xF7</code>   </td><td class="markdownTableBodyNone">Delay   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"><code>0x00 D1 D2</code>   </td></tr>
</table>
<p>The new file in .mxy format is sent via UART to the Arduino board and saved in EEPROM (function <code>song_fetch()</code> on AVR). Then, the activation of playing mode is done by <code>song_play()</code>.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Interrupt</h2>
<p>The original intention was to manually toggle between programming and playing mode by changing the voltage on a pin. An interrupt service routine would reset the program in either of the modes. Due to time constraints, this functionality was left out.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Playing the xylophone <sup><a href="https://github.com/Th0rgrlm/Xylophone/blob/main/src/xylophone/xyl.c">xyl.c</a>, <a href="https://github.com/Th0rgrlm/Xylophone/blob/main/src/main.c">main.c</a></sup></h2>
<p>The function responsible for making the xylophone play is straightforward. It sets the corresponding pin of the note to high:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define DELAY_MS 40</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> <a class="code hl_function" href="xyl_8c.html#ac70dfc916b83e62549b5ab9bf0d16b75">xyl_play_note</a>(<a class="code hl_typedef" href="structs_8h.html#a36fb5296c25f10e2efd2009ff190d27d">notes_e</a> note){</div>
<div class="line">    <span class="keywordflow">switch</span> (note)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">case</span> C1:</div>
<div class="line">            <a class="code hl_function" href="group__fryza__gpio.html#gabd54283301ad4e85b31c126f2fc316c7">GPIO_write_high</a>(&amp;PORTD, C1_PIN);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> D1:</div>
<div class="line">            <a class="code hl_function" href="group__fryza__gpio.html#gabd54283301ad4e85b31c126f2fc316c7">GPIO_write_high</a>(&amp;PORTD, D1_PIN);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">            ...</div>
<div class="line">        <span class="keywordflow">case</span> NONE:</div>
<div class="line">            <a class="code hl_function" href="group__fryza__gpio.html#gacea0f20416113eb2286b6bd730e22daa">GPIO_write_low</a>(&amp;PORTD, C1_PIN);</div>
<div class="line">            <a class="code hl_function" href="group__fryza__gpio.html#gacea0f20416113eb2286b6bd730e22daa">GPIO_write_low</a>(&amp;PORTD, D1_PIN);</div>
<div class="line">            ...</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="agroup__fryza__gpio_html_gabd54283301ad4e85b31c126f2fc316c7"><div class="ttname"><a href="group__fryza__gpio.html#gabd54283301ad4e85b31c126f2fc316c7">GPIO_write_high</a></div><div class="ttdeci">void GPIO_write_high(volatile uint8_t *reg, uint8_t pin)</div><div class="ttdoc">Write one pin to high value.</div><div class="ttdef"><b>Definition</b> gpio.c:67</div></div>
<div class="ttc" id="agroup__fryza__gpio_html_gacea0f20416113eb2286b6bd730e22daa"><div class="ttname"><a href="group__fryza__gpio.html#gacea0f20416113eb2286b6bd730e22daa">GPIO_write_low</a></div><div class="ttdeci">void GPIO_write_low(volatile uint8_t *reg, uint8_t pin)</div><div class="ttdoc">Write one pin to low value.</div><div class="ttdef"><b>Definition</b> gpio.c:54</div></div>
<div class="ttc" id="astructs_8h_html_a36fb5296c25f10e2efd2009ff190d27d"><div class="ttname"><a href="structs_8h.html#a36fb5296c25f10e2efd2009ff190d27d">notes_e</a></div><div class="ttdeci">enum notes notes_e</div><div class="ttdoc">Enum for all notes.</div></div>
<div class="ttc" id="axyl_8c_html_ac70dfc916b83e62549b5ab9bf0d16b75"><div class="ttname"><a href="xyl_8c.html#ac70dfc916b83e62549b5ab9bf0d16b75">xyl_play_note</a></div><div class="ttdeci">void xyl_play_note(notes_e note)</div><div class="ttdoc">Plays a single note.</div><div class="ttdef"><b>Definition</b> xyl.c:19</div></div>
</div><!-- fragment --><p>The function is called again after a note is played in the main program loop, as indicated in the following snippet. Calling <code><a class="el" href="xyl_8c.html#ac70dfc916b83e62549b5ab9bf0d16b75" title="Plays a single note.">xyl_play_note(notes_e note)</a></code> with <code>NONE</code> argument sets all note pins to low.</p>
<div class="fragment"><div class="line">song_ptr++;</div>
<div class="line"><a class="code hl_function" href="xyl_8c.html#ac70dfc916b83e62549b5ab9bf0d16b75">xyl_play_note</a>(value);</div>
<div class="line">_delay_ms(40);</div>
<div class="line"><a class="code hl_function" href="xyl_8c.html#ac70dfc916b83e62549b5ab9bf0d16b75">xyl_play_note</a>(NONE);</div>
<div class="line">display_note(value);</div>
</div><!-- fragment --><p>The delay of 40 milliseconds was chosen as a compromise between delay length and the force of the shooting coils. Do not confuse this delay with the delay <em>between notes</em>, which is specified in the Delay message (code from <code>main.c</code>):</p>
<div class="fragment"><div class="line"><span class="keywordflow">case</span> STATUS_DELAY_1: <span class="comment">// On 1st delay byte</span></div>
<div class="line">{</div>
<div class="line">    delay += 256 * song[song_pos++]; <span class="comment">// Get 1st delay byte</span></div>
<div class="line">    new_status = STATUS_DELAY_2; <span class="comment">// Next byte is 2nd byte of delay</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">case</span> STATUS_DELAY_2: <span class="comment">// On 2nd delay byte</span></div>
<div class="line">{</div>
<div class="line">    delay += song[song_pos++]; <span class="comment">// Get 2nd delay byte</span></div>
<div class="line">    delay_ms(delay); <span class="comment">// Play delay</span></div>
<div class="line">    delay = 0; <span class="comment">// Reset delay</span></div>
<div class="line">    new_status = STATUS_NOTE; <span class="comment">// Next byte is note specifier</span></div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">}</div>
</div><!-- fragment --><p>The tempo of the song can be easily changed in the MID file header. Tempo has the identifier <code>0x51</code>.</p>
<h1><a class="anchor" id="autotoc_md19"></a>
What we learned</h1>
<p>Delay function's argument must be a copmile time constant. </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> delay_ms(uint16_t delay)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">while</span> (delay--)</div>
<div class="line">    {</div>
<div class="line">        _delay_ms(1);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>Xylophone can't play notes simultaneously. There is an audible delay of a few ms.</p>
<p>EEPROM page size is tiny (8 bytes).</p>
<h1><a class="anchor" id="autotoc_md20"></a>
How to use</h1>
<p>Connect xylophone to pins 3-10 and to ground, after this, the logical zero will be sent to pin A0 and by that the programming code will be initialized. Next the data will be uploaded to the EEPROM memory via the PC app. After a successful upload, the program for playing the xylophone will begin. The display will show the currently played note and you will be able to listen to its beautiful sound.</p>
<p>add info how to use parser and how to prepare and export notes</p>
<h1><a class="anchor" id="autotoc_md21"></a>
Short video</h1>
<h1><a class="anchor" id="autotoc_md22"></a>
Tools</h1>
<p><a href="https://platformio.org/">PlatformIO</a></p>
<p><a href="https://www.make.com/en">Make</a></p>
<p><a href="https://inkscape.org/">Inkscape</a></p>
<p><a href="https://musescore.org/">MuseScore 4</a></p>
<h1><a class="anchor" id="autotoc_md23"></a>
References</h1>
<p><a href="https://www.music.mcgill.ca/~ich/classes/mumt306/StandardMIDIfileformat.html">Standard MIDI-File Format Spec. 1.1, updated</a></p>
<p>Digital Electronics 2 presentation by Tomas Fryza </p>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
